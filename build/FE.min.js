!function(){function t(t,e,n,i){t=e.setContextStyle(t);t.fillText(e.char,n,i)}function e(t,e){this.char=t,this.style=e||Object.create(o.text)}function n(t,n){this.ctx=t;var i=this.MCS=[];n=n?String(n):"";for(var o,r=0,a=[],s=0;o=n[r];r+=1)if("\n"===o){i.push(a);s+=1;a=[]}else a.push(new e(o));i.push(a);this.draw()}function i(){canvasNode=document.querySelector("canvas.editor");canvasNode.width=o.editor.width;canvasNode.height=o.editor.height;ctx=canvasNode.getContext("2d");var t=new n(ctx,"asdadsadsdas\n萨达大厦的asdasd阿"),e=new WeakMap,i=new WeakMap;canvasNode.addEventListener("click",function(n){function o(e){var n=t.getOffset(e.line,e.column);r.style.left=n.x+canvasNode.offsetLeft+"px";r.style.top=n.y+canvasNode.offsetTop+"px"}var r=e.get(canvasNode);if(!r){r=document.createElement("input");r.className="cursor";r.addEventListener("input",function(){var e=i.get(this);t.add(this.value,e.line,e.column);e.column+=this.value.length;t.draw();o(e);this.value=""});r.addEventListener("keydown",function(e){var n=i.get(this);switch(e.which){case 13:var r=t.newLine(n.line,n.column);t.draw();n.line=r.line;n.column=r.column;o(n)}});e.set(canvasNode,r);document.body.appendChild(r)}var a=t.getNearCInfo(n.offsetX,n.offsetY);i.set(r,a);o(a);r.focus()})}var o={editor:{height:400,width:400},text:{font_size:"14px",font_family:"思源黑体 CN Regular",color:"#222222"},d_text:{font_size:"12px",font_family:"Source Code Pro",color:"#000000"}};e.ctx=function(){return document.createElement("canvas").getContext("2d")}();e.prototype={getFontSize:function(){this.style;return this.style.font_size||o.text.font_size||o.d_text.font_size},getFontFamily:function(){return this.style.font_family||o.text.font_family||o.d_text.font_family},getFontString:function(){return this.getFontSize()+" "+this.getFontFamily()},getColor:function(){return this.style.color||o.text.color||o.d_text.color},getHeight:function(){return parseFloat(this.getFontSize())||12},setContextStyle:function(t){t.font=this.getFontString();t.textAlign="left";t.fillStyle=this.getColor();return t},getWidth:function(){var t=this.setContextStyle(e.ctx);return t.measureText(this.char).width}};var r={getLineHeight:function(t){for(var e,n=0,i=0;e=t[i];i+=1){var o=e.getHeight();o>n&&(n=o)}return n}};n.prototype={getNearCInfo:function(t,e){for(var n,i=this.MCS,o=0,a=0,s=0,c=0,f=i.length;f>c;c+=1){n=i[c];s=c;if(e>=o&&(o+=a=r.getLineHeight(n))>=e)break}var l=0,u=0,h=0;console.group(t);console.log(n);for(var d,c=0,f=n.length;f>c;c+=1){d=n[c];h=c;var g=l-u/2;u=d.getWidth();var v=l+u/2;l+=u;console.log(g,t,v);if(t>=g&&v>=t)break}console.log(c,f,h);c&&c===f&&(h+=1);console.groupEnd(t);return{C:d,x:l-u,y:o-a,line:s,column:h}},draw:function(){ctx=this.ctx;ctx.fillStyle="#FFFFFF";var e=ctx.canvas;ctx.fillRect(0,0,e.width,e.height);for(var n,i,o,a,s=this.MCS,c=0,f=0;a=s[f];f+=1){n=r.getLineHeight(a);c+=n;i=0;for(var l,u=0;l=a[u];u+=1){o=l.getWidth();t(ctx,l,i,c);i+=o}}},add:function(t,n,i){var o=this.MCS;t=t?String(t):"";if(t)for(var r,a=t.length-1;r=t[a];a-=1){var s=o[n];s||(s=o[n]=[]);var c=new e(r);s.splice(i,0,c)}},getOffset:function(t,e){for(var n,i,o=this.MCS,a=0,s=0,c=0,f=0,l=0;t>=l;l+=1){n=o[l];a+=s=r.getLineHeight(n)}for(var l=0;e>l;l+=1){i=n[l];c+=f=i.getWidth()}return{x:c,y:a-s}},newLine:function(t,e){var n=this.MCS,i=n[t],o=i.splice(e);this.MCS.splice(t+1,0,o);return{line:t+1,column:0}}};window.onload=i;define("../js/FE/main",[],function(){});define("FE.debug",[],function(){})}();define("FE",function(){});