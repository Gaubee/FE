!function t(e,n,o){function i(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+a+"'")}var f=n[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return i(n?n:t)},f,f.exports,t,e,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(t,e){e.exports={text:{font_size:"14px",font_family:"思源黑体 CN Regular",color:"#222222"}}},{}],2:[function(t){function e(t,e,n,o){t=e.setContextStyle(t);t.fillText(e.char,n,o)}function n(t,e){this.char=t,this.style=e||Object.create(r.text)}function o(t,e){this.ctx=t;var o=this.MCS=[];e=e?String(e):"";for(var i,r=0,a=[],s=0;i=e[r];r+=1)if("\n"===i){o.push(a);s+=1;a=[]}else a.push(new n(i));o.push(a);this.draw()}function i(){canvasNode=document.querySelector("canvas.editor");canvasNode.width=r.editor.width;canvasNode.height=r.editor.height;ctx=canvasNode.getContext("2d");var t=new o(ctx,"asdadsadsdas\n萨达大厦的asdasd阿"),e=new WeakMap,n=new WeakMap;canvasNode.addEventListener("click",function(o){function i(e){var n=t.getOffset(e.line,e.column);r.style.left=n.x+canvasNode.offsetLeft+"px";r.style.top=n.y+canvasNode.offsetTop+"px"}var r=e.get(canvasNode);if(!r){r=document.createElement("input");r.className="cursor";r.addEventListener("input",function(){var e=n.get(this);t.add(this.value,e.line,e.column);e.column+=this.value.length;t.draw();i(e);this.value=""});r.addEventListener("keydown",function(e){var o=n.get(this);switch(e.which){case 13:var r=t.newLine(o.line,o.column);t.draw();o.line=r.line;o.column=r.column;i(o)}});e.set(canvasNode,r);document.body.appendChild(r)}var a=t.getNearCInfo(o.offsetX,o.offsetY);n.set(r,a);i(a);r.focus()})}var r=(t("./config/setting.user"),{editor:{height:400,width:500},text:{font_size:"14px",font_family:"思源黑体 CN Regular",color:"#222222"},d_text:{font_size:"12px",font_family:"Source Code Pro",color:"#000000"}});n.ctx=function(){return document.createElement("canvas").getContext("2d")}();n.prototype={getFontSize:function(){this.style;return this.style.font_size||r.text.font_size||r.d_text.font_size},getFontFamily:function(){return this.style.font_family||r.text.font_family||r.d_text.font_family},getFontString:function(){return this.getFontSize()+" "+this.getFontFamily()},getColor:function(){return this.style.color||r.text.color||r.d_text.color},getHeight:function(){return parseFloat(this.getFontSize())||12},setContextStyle:function(t){t.font=this.getFontString();t.textAlign="left";t.fillStyle=this.getColor();return t},getWidth:function(){var t=this.setContextStyle(n.ctx);return t.measureText(this.char).width}};var a={getLineHeight:function(t){for(var e,n=0,o=0;e=t[o];o+=1){var i=e.getHeight();i>n&&(n=i)}return n}};o.prototype={getNearCInfo:function(t,e){for(var n,o=this.MCS,i=0,r=0,s=0,c=0,f=o.length;f>c;c+=1){n=o[c];s=c;if(e>=i&&(i+=r=a.getLineHeight(n))>=e)break}var l=0,u=0,h=0;console.group(t);console.log(n);for(var d,c=0,f=n.length;f>c;c+=1){d=n[c];h=c;var g=l-u/2;u=d.getWidth();var v=l+u/2;l+=u;console.log(g,t,v);if(t>=g&&v>=t)break}console.log(c,f,h);c&&c===f&&(h+=1);console.groupEnd(t);return{C:d,x:l-u,y:i-r,line:s,column:h}},draw:function(){ctx=this.ctx;ctx.fillStyle="#FFFFFF";var t=ctx.canvas;ctx.fillRect(0,0,t.width,t.height);for(var n,o,i,r,s=this.MCS,c=0,f=0;r=s[f];f+=1){n=a.getLineHeight(r);c+=n;o=0;for(var l,u=0;l=r[u];u+=1){i=l.getWidth();e(ctx,l,o,c);o+=i}}},add:function(t,e,o){var i=this.MCS;t=t?String(t):"";if(t)for(var r,a=t.length-1;r=t[a];a-=1){var s=i[e];s||(s=i[e]=[]);var c=new n(r);s.splice(o,0,c)}},getOffset:function(t,e){for(var n,o,i=this.MCS,r=0,s=0,c=0,f=0,l=0;t>=l;l+=1){n=i[l];r+=s=a.getLineHeight(n)}for(var l=0;e>l;l+=1){o=n[l];c+=f=o.getWidth()}return{x:c,y:r-s}},newLine:function(t,e){var n=this.MCS,o=n[t],i=o.splice(e);this.MCS.splice(t+1,0,i);return{line:t+1,column:0}}};window.onload=i},{"./config/setting.user":1}]},{},[2]);